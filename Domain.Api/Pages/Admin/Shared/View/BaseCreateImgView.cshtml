@using System.Reflection
@using Domain.Api.Extensions
@using Domain.Generics.Persistance
@using Domain.Persistance.Entities.Entities

@{
    Layout = "~/Pages/Admin/Shared/View/BaseCreateView.cshtml";

    var item = (Entity)ViewData["Entity"];
    var images = ViewData["Images"] as IEnumerable<Image>;
}

<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>


@if (images != null)
{
    @foreach (var img in images)
    {
        <div class="form-group">
            <div class="row">
                <div class="col-md-6">
                    <!-- image-preview-filename input [CUT FROM HERE]-->
                    <div class="input-group image-preview">
                        <input type="text" class="form-control" disabled="disabled" value="@img.ImagePath"> <!-- don't give a name === doesn't send on POST/GET -->
                        <span class="input-group-btn">
                            <!-- image-preview-clear button -->

                            <a class="btn btn-default" href="/Admin/Shared/DeleteFile?filepath=@img.ImagePath&returnUrl=@Context.Request.Path?id=@item.Id">
                                <span class="glyphicon glyphicon-remove"></span> Delete
                            </a>
                        </span>
                    </div><!-- /input-group image-preview [TO HERE]-->
                </div>
            </div>
        </div>
    }

}


<div class="form-group">
    <div class="row">
        <div class="col-xs-12 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
            <!-- image-preview-filename input [CUT FROM HERE]-->
            <div class="input-group image-preview" id="image-preview">
                <input type="text" class="form-control image-preview-filename" disabled="disabled" value=""> <!-- don't give a name === doesn't send on POST/GET -->
                <span class="input-group-btn">
                    <!-- image-preview-clear button -->
                    <button type="button" class="btn btn-default image-preview-clear" style="display:none;">
                        <span class="glyphicon glyphicon-remove"></span> Clear
                    </button>
                    <!-- image-preview-input -->
                    <div class="btn btn-default image-preview-input">
                        <span class="glyphicon glyphicon-folder-open"></span>
                        <span class="image-preview-input-title">Browse</span>
                        <input type="file" name="input-file-preview" /> <!-- rename it -->
                    </div>
                </span>
            </div><!-- /input-group image-preview [TO HERE]-->
        </div>
    </div>
</div>

<style>
    .container {
        margin-top: 20px;
    }

    .image-preview-input {
        position: relative;
        overflow: hidden;
        margin: 0px;
        color: #333;
        background-color: #fff;
        border-color: #ccc;
    }

        .image-preview-input input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            padding: 0;
            font-size: 20px;
            cursor: pointer;
            opacity: 0;
        }

    .image-preview-input-title {
        margin-left: 2px;
    }
</style>
<script>
    $(function() {
        // Clear event
        $('.image-preview-clear').click(function(){
            $('.image-preview').attr("data-content","").popover('hide');
            $('.image-preview-filename').val("");
            $('.image-preview-clear').hide();
            $('.image-preview-input input:file').val("");
            $(".image-preview-input-title").text("Browse");
        });
                                    $('.image-preview-clear').click(function(){
            $('.image-preview-input input:file').val("");
            $(".image-preview-input-title").text("Browse");
        });
        // Create the preview image
        $(".image-preview-input input:file").change(function (){
            var file = this.files[0];
            var reader = new FileReader();
            // Set preview image into the popover data-content
            reader.onload = function (e) {
                $(".image-preview-input-title").text("Change");
                $(".image-preview-clear").show();
                $(".image-preview-filename").val(file.name);
            }
            reader.readAsDataURL(file);
        });
    });
</script>


@RenderBody()
